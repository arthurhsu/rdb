<section>
  <h2>Schema Query</h2>
  <p>A database instance is created using schema queries. The associated schema
  of the database can also be altered using schema queries. Schema queries are
  run in the context of <a>transaction</a> and can be executed any time during
  the life time of the database.</p>

  <section>
    <h2>Database-Level Schema Query</h2>
    <p>The <code>ISchemaQueryProvider</code> is the interface of manipulating
    database-level schema:</p>
    <pre class="idl">
      interface ISchemaQueryProvider {
        IExecutionContext exportSchema();
        IExecutionContext create(Object schema);
        IExecutionContext setVersion(unsigned short version);
        IDatabaseSchema schema();
        ITableBuilder createTable();
        ITableChanger alterTable();
      };
    </pre>
    <dl class="methods">
      <dt><code>IExecutionContext exportSchema();</code></dt>
      <dd>Export schema object, MUST be run in the context of a
      <a>transaction</a>.</dd>
      <dt><code>IExecutionContext create(Object schema);</code></dt>
      <dd>Create database schema from provided schema object, MUST be run in
      the context of a <a>transaction</a>. The schema object MUST conform to
      the format defined in <a href="#schema-definition-json-format">
      Schema Definition JSON Format</a>. Any error in the schema will result in
      transaction failure with <a>InvalidSchemaError</a>.</dd>
      <dt><code>IExecutionContext setVersion(unsigned short version);</code>
      </dt>
      <dd>Sets the version number of the schema, MUST be run in the context of
      a <a>transaction</a>.</dd>
      <dt><code>IDatabaseSchema schema();</code></dt>
      <dd>Returns an <code>IDatabaseSchema</code> object for crafting data
      manipulation queries.</dd>
      <dt><code>ITableBuilder createTable();</code></dt>
      <dd>Returns a table builder for creating a new table.</dd>
      <dt><code>ITableChanger alterTable(string tableName);</code></dt>
      <dd>Returns a table builder for altering an existing table. The table
      referred by <code>tableName</code> MUST already exist in the database,
      otherwise a <a>DataError</a> will be raised.</dd>
    </dl>
  </section>
  <section>
    <h2>Database Schema</h2>
    <p>Database schema obtained from <code>ISchemaQueryProvider.schema()</code>
    provides <code>IDatabaseSchema</code> interface.</p>
    <pre class="idl">
      interface IDatabaseSchema {
        readonly attribute DOMString name;
        readonly attribute unsigned short version;
        object table(DOMString tableName);
      };
    </pre>
    <dl class="attributes">
      <dt><code>DOMString name</code></dt>
      <dd>Name of the database.</dd>
      <dt><code>unsigned short version</code></dt>
      <dd>Version of the database schema.</dd>
    </dl>
    <dl class="methods">
      <dt><code>object table(DOMString tableName);</code></dt>
      <dd>Returns a read-only dictionary object, whose members are
      <a>IColumn</a> objects representing columns in the specified table.
      The table referred by <code>tableName</code> MUST already exist in the
      database, otherwise a <a>DataError</a> will be raised.</dd>
    </dl>
  </section>

  <pre class="idl">
    interface ITableBuilder : IExecutionContext {
      ITableBuilder column(DOMString name, ColumnType type, optional boolean notNull = false);
      ITableBuilder primaryKey(PrimaryKeyDefinition primaryKey);
      ITableBuilder foreignKey(ForeignKeySpec foreignKey);
      ITableBuilder unique(DOMString name, IndexedColumnDefinition columns);
      ITableBuilder index(DOMString name, IndexedColumnDefinition columns);
    };
  </pre>

  <pre class="idl">
    interface ITableChanger : IExecutionContext {
      ITableChanger rename(DOMString newTableName);
      ITableChanger addColumn(DOMString name, ColumnType type, optional boolean notNull = false);
      ITableChanger dropColumn(DOMString name);
      IColumnChanger setColumn(DOMString name);
    };
  </pre>

  <pre class="idl">
    interface IColumnChanger {
      ITableChanger set(DOMString newColumnName, ColumnType newType, optional boolean notNull = true);
    };
  </pre>

  <p>The following example demonstrates how to create a database schema.</p>
    <pre class="example highlight">
    {{include: create-by-api.js}}
  </pre>

  <pre class="idl">
    interface ITable {
      readonly attribute DOMString name;
      ITable as(DOMString alias);
    };
  </pre>

  <pre class="idl">
    interface IColumn : IPredicate {
      readonly attribute DOMString name;
      readonly attribute ColumnType type;
      readonly attribute boolean nullable;
      IColumn as(DOMString alias);
    };
  </pre>
</section>
